name: Deploy via SSH (SFTP) to Lolipop

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # 不要な管理ファイルを削除
      - name: Remove unnecessary files
        run: rm -rf .git .github

      # ファイル転送（ロリポップ対策版）
      - name: Copy files via SSH password
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          password: ${{ secrets.SSH_PASS }}
          port: 2222
          
          # 転送するファイル
          source: "index.html,images/**"
          
          # ターゲットディレクトリ
          target: "web/houseinfo/lp/log_kassel"
          
          # --- ロリポップでの「tarエラー」対策 ---
          # サーバー内の一時保存先を、制限のある /tmp ではなく自分のフォルダに指定します
          tar_tmp_path: "web/houseinfo/lp"
          
          # 転送量増加に伴うタイムアウト防止
          timeout: 60s
          command_timeout: 2m
          
          overwrite: true
          strip_components: 0
